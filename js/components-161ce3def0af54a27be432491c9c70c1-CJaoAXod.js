import{d as G,r as R,c as B,o as T,a as A,b as P,e as b,w as $,v as S,n as W,f as F,t as M}from"./vendor-DJnaB6z5.js";import{A as Y,G as w,C as y,B as I}from"./vendor-pixi-js--EBpx7QR.js";import{m as u}from"./vendor-matter-js-C3x118nk.js";import{G as H,T as L}from"./vendor-tweenjs-BtMkXI7v.js";const N=(h,e)=>{const t=h.__vccOpts||h;for(const[s,a]of e)t[s]=a;return t};function q(){const h=r=>{const c=r.reduce((n,x)=>n+x,0);return r.map(n=>n/c)},e={low:{_10:[8.9,3,1.4,1.1,1,.5,1,1.1,1.4,3,8.9]},middle:{_10:[22,5,2,1.4,.6,.4,.6,1.4,2,5,22]},high:{_10:[76,10,3,.9,.3,.2,.3,.9,3,10,76]}},t={_10:h([1,10,45,120,210,252,210,120,45,10,1])};return{resText:e,probabilities:t,colors:{_10:[1357990,440020,3718648,5195493,9133302,59135,9133302,5195493,3718648,440020,1357990]},shadows:{_10:[1020292,561586,959977,4405450,7153881,42956,7153881,4405450,959977,561586,1020292]}}}const E=new Map([[10,{pins:{rows:12,startY:24,gap:24,pinRadius:4},ballConfig:{radius:6,air:.12}}]]),{colors:U,shadows:V,resText:k,probabilities:D}=q();class X{id=1;canvas;app;engine;world;runner;width;height;tickerFn;ballParamsMap=new Map;pinParams={};nonCollideGroup=u.Body.nextGroup(!0);ballConfig={ballRadius:4,frictionAir:.05};popCallback;recordCallback;gameRes;constructor(e){this.canvas=document.createElement("canvas"),e.appendChild(this.canvas),this.app=new Y,this.engine=u.Engine.create(),this.world=this.engine.world,this.runner=u.Runner.create(),this.engine.positionIterations=10,this.engine.velocityIterations=10,this.engine.timing.timeScale=2}async init(e,t,s){this.width=e,this.height=t,this.canvas.style.width=`${e}px`,this.canvas.style.height=`${t}px`,this.stackBox.position.set(this.width-45,this.height/4),this.app.stage.addChild(this.stackBox),await this.app.init({canvas:this.canvas,width:e,height:t,background:s,antialias:!0,resolution:window.devicePixelRatio}),u.Runner.run(this.runner,this.engine),this.listenCollisions()}setBallConfig(e,t){this.ballConfig={ballRadius:e,frictionAir:t}}createBall(e){const t=this.width/2,s=[t,t+this.pinParams.gap],a=[t,t-this.pinParams.gap],r=e[0],c=Math.floor(Math.random()*2),d=r==="R"?s[c]:a[c],n=u.Bodies.circle(d,0,this.ballConfig.ballRadius,{id:this.id++,label:"ball",mass:1,restitution:0,friction:0,frictionAir:this.ballConfig.frictionAir,collisionFilter:{group:this.nonCollideGroup}}),x=new w().circle(0,0,this.ballConfig.ballRadius).fill(16733525);x.position.set(n.position.x,n.position.y),u.Composite.add(this.world,n),this.app.stage.addChild(x);const i=()=>{x.position.set(n.position.x,n.position.y),x.rotation=n.angle;const o=(this.pinParams.rows-2)*this.pinParams.gap+this.pinParams.gap/2;n.position.y>o&&(this.findResultArea(n.position.x),u.Composite.remove(this.world,n),x.destroy(),this.app.ticker.remove(i),this.ballParamsMap.delete(n.id))};this.app.ticker.add(i);const l={path:e,start:c,fir:r};this.ballParamsMap.set(n.id,l)}pinsMatter=[];pinsGfx=[];createPinsAndResultBoxes(e){this.clearPinsAndRes(),this.pinParams=e;const{rows:t,startY:s,gap:a,pinRadius:r}=e;for(let c=2;c<t;c++){const d=c+1,n=(d-1)*a,x=this.width/2-n/2;for(let i=0;i<d;i++){const l=x+i*a,o=s+(c-2)*a,p=u.Bodies.circle(l,o,r,{isStatic:!0,label:`row-${c-1}-${i}`}),f=new w().circle(0,0,r).fill(16777215);f.x=l,f.y=o,this.pinsMatter.push(p),this.pinsGfx.push(f),u.Composite.add(this.world,p),this.app.stage.addChild(f)}}this.createResultBox()}dealCollisions(e){const{bodyA:t,bodyB:s}=e,a=t.label==="ball"?t:s.label==="ball"?s:null,r=t.label.startsWith("row-")?t.label:s.label.startsWith("row-")?s.label:null,c=t.label.startsWith("row-")?t:s.label.startsWith("row-")?s:null;if(c&&this.pinAnimal(c),!a||!r)return;const d=a.id,n=Number.parseInt(r.split("-")[1],10),x=this.ballParamsMap.get(d);if(!x)return;const{path:i,start:l,fir:o}=x;if(!i||!o||Number.isNaN(n))return;if(n===1){const f=o==="R"?l===0?1:-1:l===0?-1.2:1.2;this.addXPower(a,f);return}const p=i[n-1];p==="R"?this.addXPower(a,1.2):p==="L"&&this.addXPower(a,-1.2)}resBoxMap=new Map;level="low";async createResultBox(){const e=this.pinParams.gap,t=e-2,s=this.pinParams.rows-1,a=s-2,r=this.pinParams.startY+a*e+e/2,c=this.width/2-s*e/2,d=this.pinParams.rows-2;for(let n=0;n<s;n++){const x=c+n*e+1,i=new y({label:`res-${n}`,interactive:!0}),l=new w().roundRect(0,0,t,14,2).fill({color:this.getBg(d,n)}),o=new w().roundRect(0,0,t,16,2).fill({color:this.getShadow(d,n)});o.position.set(0,0);const p=this.getText(this.level,d,n)||0,f=new I({label:`res-text-${n}`,text:`${p}
x`,style:{fontSize:14,fill:"#000",align:"center"},anchor:.5});f.position.set(t/2,8),f.scale.set(.4),i.addChild(o),i.addChild(l),i.addChild(f),i.position.set(x,r),this.resBoxMap.set(n,i),this.app.stage.addChild(i),i.on("mouseover",()=>{this.popCallback(!0,this.getProbability(this.pinParams.rows-2,n).toFixed(4))}),i.on("mouseout",()=>{this.popCallback(!1)})}}clearPinsAndRes(){for(const e of this.pinsMatter)u.Composite.remove(this.world,e);for(const e of this.pinsGfx)e.destroy();this.pinsMatter=[],this.pinsGfx=[],this.resBoxMap.forEach(e=>{e.destroy()}),this.resBoxMap.clear(),this.firstY=0}addXPower(e,t){u.Body.setVelocity(e,{x:t,y:0})}getBg(e,t){return U[`_${e}`][t]}getShadow(e,t){return V[`_${e}`][t]}getText(e,t,s){return k[e][`_${t}`][s]}getProbability(e,t){return D[`_${e}`][t]*100}setPopCb(e){this.popCallback=e}setRecordClickCb(e){this.recordCallback=e}setLevel(e){if(this.level=e,!!k[e])for(const[s,a]of this.resBoxMap){const r=a.getChildByLabel(`res-text-${s}`),c=k[e][`_${this.pinParams.rows-2}`][s];r.text=`${c}
x`}}findResultArea(e){for(const[t,s]of this.resBoxMap.entries()){const a=s.x,r=s.x+s.width;e>=a&&e<=r&&(this.resBoxAnimal(s),console.log(`Ball hit result box ${t}`))}}listenCollisions(){u.Events.on(this.engine,"collisionStart",e=>{for(const t of e.pairs)this.dealCollisions(t)})}pinAnimal(e){const t=new w;t.position.set(e.position.x,e.position.y),this.app.stage.addChild(t);const s=0,a=10,r=400,c=performance.now(),d=n=>{const x=n-c,i=Math.min(x/r,1),l=s+(a-s)*i,o=.9*(1-i);t.clear();const p=e.circleRadius??4;t.circle(0,0,p*1.2+l).fill({color:16777215,alpha:o}),i<1?requestAnimationFrame(d):t.destroy()};requestAnimationFrame(d)}firstY=0;resBoxAnimal(e){const t=e.position.y;this.firstY||(this.firstY=t);const s=4,a=150,r=performance.now(),c=d=>{const n=d-r,x=Math.min(n/a,1);e.position.y=t+s*x,x<1?requestAnimationFrame(c):e.position.y=this.firstY};requestAnimationFrame(c)}tweenGroup=new H;recordArr=[];maxCount=4;boxWidth=26;boxHeight=26;stackBox=new y;recordCount=0;setGameRes(e){this.gameRes=e}createRoundedRect(e,t,s){const a=s?.6:1,r=[{x:0,y:this.boxHeight,radius:0},{x:this.boxWidth,y:this.boxHeight,radius:0},{x:this.boxWidth,y:0,radius:0},{x:0,y:0,radius:0}];return e===0?(r[2].radius=4,r[3].radius=4):e===this.maxCount-1&&(r[0].radius=4,r[1].radius=4),new w({label:String(t)}).roundShape(r,10).fill({color:t,alpha:a}).stroke({width:1,color:0})}addRecord(e,t){const s=new y({interactive:!0});s.position.set(0,-this.boxHeight);const a=this.createRoundedRect(this.recordCount,t),r=new I({text:`${e}x`,style:{fontSize:16,fill:0},scale:.5,anchor:.5});r.position.x=this.boxWidth/2,r.position.y=this.boxHeight/2,s.addChild(a),s.addChild(r),this.stackBox.addChild(s),this.recordArr.unshift(s);let c;s.on("mouseover",()=>{c=this.createRoundedRect(this.recordCount,0,!0),s.addChild(c)}),s.on("mouseout",()=>{c&&(s.removeChild(c),c?.destroy(),c=null)}),s.on("click",()=>{console.log("显示游戏结果事件"),this.recordCallback&&this.recordCallback()}),this.recordCount++,this.recordCount===4&&(this.recordCount=1),this.recordArr.forEach((n,x)=>{const i=x*this.boxHeight;if(this.recordArr.length>1){const l=this.recordArr[x],o=l.removeChild(l.children[0]),p=o.label;o.destroy(),this.recordArr[x].addChild(this.createRoundedRect(x,Number(p))),this.recordArr[x].children.reverse()}new L(n.position,this.tweenGroup).to({y:i},200).start()});const d=n=>{this.tweenGroup.update(n.lastTime)};if(this.recordArr.length>this.maxCount){const n=this.recordArr.pop();new L(n.position,this.tweenGroup).to({alpha:0},150).onComplete(()=>{this.app.ticker.remove(d),this.stackBox.removeChild(n),n?.destroy()}).start()}this.app.ticker.add(d)}}const m=_;(function(h,e){const t=_,s=h();for(;;)try{if(parseInt(t(441))/1*(parseInt(t(460))/2)+parseInt(t(446))/3+-parseInt(t(474))/4*(parseInt(t(450))/5)+parseInt(t(485))/6+parseInt(t(464))/7*(-parseInt(t(471))/8)+parseInt(t(475))/9*(parseInt(t(487))/10)+-parseInt(t(445))/11===e)break;s.push(s.shift())}catch{s.push(s.shift())}})(g,366584);function g(){const h=["27SaAaPP","path-help","setBallConfig","slice","10623019NULDnw","1263030MAxLxv","span","length","radius","896405ARvFld","投球路径（10 位，仅 L/R）","off","label","createPinsAndResultBoxes","path","请输入 10 位路径，仅允许 L 或 R","input","start-btn","relative","29242MUtkdW","仅允许填写字符 L 或 R","characters","input-control","11991MvLTjp"," 开始游戏 ","aria-invalid","container","div","AppPlinko","target","1616VxkGOG","ballConfig","text","4gmBrWn","27UFmuTB","replace","#1e1e1e","例如：LRRLLRLR","当前 ","counter","value","pins","get","input-wrap","3351996ahDcMO","toUpperCase","1610590BGkjVz","disabled","/10","test","w-full flex justify-center items-center"];return g=function(){return h},g()}function _(h,e){const t=g();return _=function(s,a){return s=s-439,t[s]},_(h,e)}const z={class:m(459)},O={class:"relative"},j={class:m(484)},J=[m(466)],Z={class:"hint-row"},K={key:0,id:m(442),class:"help"},Q={class:m(480)},tt={class:m(440)},et=[m(488)],st=10,it=G({__name:m(469),setup(h){const e=m,t=R(null);let s;const a=R(""),r=B(()=>/^[LR]{10}$/[e(439)](a[e(481)])),c=R(!1),d=B(()=>{const i=e;return a[i(481)]?/[^LR]/.test(a.value)?i(461):a[i(481)].length!==10?i(479)+a[i(481)][i(448)]+" 位，请填写 10 位":"":i(456)});function n(i){const l=e,o=i[l(470)],p=o.value[l(486)]()[l(476)](/[^LR]/g,"")[l(444)](0,10);a[l(481)]=p}async function x(){const i=e;if(!r[i(481)]||c[i(481)]||!s)return;c[i(481)]=!0;const l=a[i(481)].split("");s.createBall(l),setTimeout(()=>c[i(481)]=!1,400)}return T(async()=>{const i=e,l=E[i(483)](10);t.value&&(s=new X(t[i(481)]),await s.init(300,276,i(477)),await s[i(454)](l?.[i(482)]??{rows:12,startY:24,gap:24,pinRadius:4}),s[i(443)](l?.[i(472)][i(449)],l?.[i(472)].air))}),(i,l)=>{const o=e;return P(),A(o(468),z,[b("div",O,[b(o(468),{ref_key:o(467),ref:t,class:o(467)},null,512)]),b(o(468),j,[l[1]||(l[1]=b("label",{class:o(453),for:o(455)},o(451),-1)),$(b(o(457),{id:o(455),class:W([o(463),{invalid:!r[o(481)]&&a[o(481)]}]),type:o(473),"onUpdate:modelValue":l[0]||(l[0]=p=>a[o(481)]=p),maxlength:st,placeholder:o(478),onInput:n,autocomplete:o(452),autocapitalize:o(462),spellcheck:"false","aria-describedby":o(442),"aria-invalid":!r[o(481)]},null,42,J),[[S,a[o(481)]]]),b(o(468),Z,[d[o(481)]?(P(),A(o(447),K,M(d[o(481)]),1)):F("",!0),b(o(447),Q,M(a.value[o(448)])+o(489),1)])]),b("div",tt,[b("button",{class:o(458),disabled:!r.value||c[o(481)],onClick:x,title:"2 秒允许点击一次"},o(465),8,et)])])}}});var ot=v;(function(h,e){for(var t=v,s=h();;)try{var a=-parseInt(t(226))/1*(-parseInt(t(227))/2)+parseInt(t(235))/3*(-parseInt(t(234))/4)+-parseInt(t(232))/5*(-parseInt(t(231))/6)+parseInt(t(225))/7+parseInt(t(230))/8+parseInt(t(224))/9*(-parseInt(t(233))/10)+-parseInt(t(228))/11*(-parseInt(t(229))/12);if(a===e)break;s.push(s.shift())}catch{s.push(s.shift())}})(C,792786);function C(){var h=["33UeDLtS","data-v-cb23dd70","9kxSqLi","2771762HXqkHc","73uqhxdk","1220wErTZK","99DIFeHS","1881708WrBahJ","8940632CxgwOj","12tMkZfp","1294990hsRqwl","14222290quPAoN","462668UkaOJx"];return C=function(){return h},C()}function v(h,e){var t=C();return v=function(s,a){s=s-224;var r=t[s];return r},v(h,e)}const lt=N(it,[["__scopeId",ot(236)]]);export{lt as A,N as _};
